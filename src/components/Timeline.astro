---
import {TimelineCompany} from "../interfaces/timeline-company";
interface Props {
    companies: TimelineCompany[];
}
const {companies} = Astro.props;
import {useTranslations} from "../i18n/utils";
import TimelineCard from "./TimelineCard.astro";
import Container from "../layouts/Container.astro";
import Spacer from "../layouts/Spacer.astro";
import {StyleSPEnum} from "../styles/enums/sp.enum";
import Box from "../layouts/Box.astro";
import {Image} from 'astro:assets';
import Flex from "../layouts/Flex.astro";
import {StyleAlignItemsEnum} from "../styles/enums/align-items.enum";
import Text from "../layouts/Text.astro";
import {StyleFSEnum} from "../styles/enums/fs.enum";
import {StyleFWEnum} from "../styles/enums/fw.enum";
const {t} = useTranslations(Astro.url);
function getDate(date: Date | null) {
    if (!date) return t('timeline.currently');
    return t(`timeline.months.${date.getMonth()}`) + ' ' + date.getFullYear();
}
---

<section>
    <Spacer size={StyleSPEnum.SP128}/>
    <Container class="container">
        {companies.map((company) =>
                <Box class="container-container">
                    <Box p={StyleSPEnum.SP8} class="company-info">
                        <Text fontSize={StyleFSEnum.FS14} fontWeight={StyleFWEnum.LIGHT}>
                            {getDate(company.projects[0].startDate)}
                        </Text>
                        <Spacer size={StyleSPEnum.SP8}/>
                        <Text fontSize={StyleFSEnum.FS16} fontWeight={StyleFWEnum.REGULAR}>
                            {company.name}
                        </Text>
                        <Spacer size={StyleSPEnum.SP4}/>
                        <Image class="company-image" src={company.logo}
                               alt={`${company.name} logo`} loading="eagle"/>
                        <Spacer size={StyleSPEnum.SP4}/>
                    </Box>
                    {company.projects.map((project) =>
                            <Flex>
                                {company.side === 'right' &&
                                        <>
                                            <Box class="timeline-image-container">
                                                <Image class="timeline-image" src={project.proyectImage}
                                                       alt={`${project.proyectName} project`} loading="eagle"/>
                                            </Box>
                                            <Flex justifyContent={StyleAlignItemsEnum.CENTER}
                                                  class="project-line-container">
                                                <Box style={{background: project.color}} class="project-line"/>
                                            </Flex>
                                            <Box class="timeline-card">
                                                <TimelineCard {...project.proyectCardProps}/>
                                            </Box>
                                        </>}


                                {company.side === 'left' &&
                                        <>
                                            <Box class="timeline-card">
                                                <TimelineCard {...project.proyectCardProps}/>
                                            </Box>
                                            <Flex justifyContent={StyleAlignItemsEnum.CENTER}
                                                  class="project-line-container">
                                                <Box style={{background: project.color}} class="project-line"/>
                                            </Flex>
                                            <Box class="timeline-image-container">
                                                <Image class="timeline-image" src={project.proyectImage}
                                                       alt={`${project.proyectName} project`} loading="eagle"/>
                                            </Box>
                                        </>}

                            </Flex>
                    )}
                </Box>
        )}
    </Container>
</section>

<script>
    const containers: HTMLElement[] = document.querySelectorAll('.container-container') as HTMLElement[];
    const companyInfos: HTMLElement[] = document.querySelectorAll('.company-info') as HTMLElement[];

    document.addEventListener("scroll", (event) => {
        const windowMiddle = window.innerHeight / 2;
        containers.forEach((container, index) => {
            const companyInfo: HTMLElement = companyInfos[index];
            const diff = container.getBoundingClientRect().top - windowMiddle;
            if (diff < 0) {
                companyInfo.style.top = Math.abs(diff) + 'px';
            }
        })
    });

</script>

<style lang="scss">
  @import "../styles/vars";

  $centerWidth: 230px;

  .company-image {
    max-width: 44px;
    max-height: 44px;
  }

  .container-container {
    margin-top: $sp128;
    position: relative;
  }

  .company-info {
    position: absolute;
    width: $centerWidth;
    left: calc(50% - $centerWidth / 2);
    top: 0;
    text-align: center;
    background-color: $white;
    transform: translateY(-100%);
  }

  .timeline-image-container {
    align-self: stretch;
    flex: 1;

    .timeline-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
  }

  .timeline-card {
    flex: 1;
  }

  .project-line-container {
    width: $centerWidth;
    align-self: stretch;

    .project-line {
      width: 4px;
      height: 100%;
      border-radius: 5px;
    }
  }
</style>